{% extends "base.html" %}

{% block title %}Ad Hoc Chat - Code Reviser UI{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="card">
        <div class="card-body" id="chat-container">
            <!-- Chat messages will be displayed here -->
            {% for message in current_result.split('\n') %}
            <div>{{ message }}</div>
            {% endfor %}
        </div>
        <div class="card-footer">
            <form id="chat-form" method="POST" action="{{ url_for('ad_hoc_chat') }}">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Enter your prompt" name="prompt" required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function updateChat() {
        // Fetch latest tokens from the server
        fetch("{{ url_for('ad_hoc_chat') }}")
            .then(response => response.json())
            .then(data => {
                const chatContainer = document.getElementById('chat-container');
                // Update the chat messages
                chatContainer.innerHTML = data.result.split('\n').map(message => `<div>${message}</div>`).join('');
            });
    }

    // Refresh every 5 seconds
    setInterval(updateChat, 5000);
</script>

{% endblock %}